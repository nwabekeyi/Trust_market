import{r as d,i as E,j as t,b as L}from"./index-72EGJmst.js";import{N as v}from"./navWrapper-C9-0aqWt.js";import{c as N,a as p,C,T as k}from"./index.esm-3X35CrkS.js";import{e as f}from"./constant-DO_PPxh-.js";const R="/assets/login-image-BTIRhNGW.svg",A="/assets/seller-login-Dfs7KCAR.webp",T=(e,s)=>{const n=new Date().getTime()+s*1e3;localStorage.setItem("accessToken",e),localStorage.setItem("accessTokenExpiry",n)},w=()=>localStorage.getItem("accessToken"),x=()=>parseInt(localStorage.getItem("accessTokenExpiry"),10),U=e=>{document.cookie=`refreshToken=${e}; path=/; HttpOnly;`},y=()=>{const e=document.cookie.split(";");for(let s=0;s<e.length;s++){const n=e[s].trim();if(n.startsWith("refreshToken="))return n.substring(13)}return null},F=e=>{document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`},O=()=>{const[e,s]=d.useState(!1),n=E();d.useEffect(()=>{const o=y(),a=w(),r=x();o&&a&&new Date().getTime()<r&&(s(!0),h())},[]);const g=async(o,a,r)=>{try{const c=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,password:a})});if(!c.ok)throw new Error("Login failed");const m=await c.json(),{accessToken:j,refreshToken:I,expiresIn:S,userId:b}=m;console.log(m),T(j,S),U(I),s(!0),h(),u(b)}catch(c){console.error("Login error:",c)}},u=d.useCallback(async o=>{const a=f.getUser+"/"+o;console.log(a);try{if(!w())throw new Error("Access token not found");console.log("access token gotten");const c=await fetch(a,{});if(!c.ok)throw new Error("Failed to fetch user info");const m=await c.json();console.log("User Info:",m),n("/dashboard")}catch(r){console.error("Fetch user info error:",r)}},[n]),i=async()=>{try{await fetch("https://your-auth-api.com/logout",{method:"POST",headers:{"Content-Type":"application/json"}}),localStorage.removeItem("accessToken"),localStorage.removeItem("accessTokenExpiry"),F("refreshToken"),s(!1)}catch(o){console.error("Logout error:",o)}},l=async()=>{try{if(!y())throw new Error("Refresh token not found");const a=await fetch("https://your-auth-api.com/refresh-token",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!a.ok)throw new Error("Failed to refresh access token");const r=await a.json(),{accessToken:c}=r;T(c,900),s(!0)}catch(o){console.error("Refresh token error:",o),i()}},h=()=>{const o=x();if(!o)return;const r=o-new Date().getTime()-6e4;r>0?setTimeout(()=>{l()},r):l()};return{isLoggedIn:e,login:g,logout:i}},P=()=>{const e=L(),{login:s}=O(),n=e.pathname==="/auth1/buyer-sign-in"?f.buyerLogin:f.sellerLogin;console.log(n);const g=N().shape({email:p().required("Email is required"),password:p().required("Password is required")}),u=async(i,{setSubmitting:l})=>{try{await s(i.email,i.password,n)}catch(h){console.error("Login error:",h)}finally{l(!1)}};return t.jsxs("div",{className:"mx-20 flex gap-2 items-center ",children:[t.jsx("div",{className:"w-1/2 h-full hidden lg:block ",children:t.jsx("img",{src:e.pathname==="/auth1/buyer-sign-in"?R:A,className:"h-full w-full object-cover ",alt:"Login Image"})}),t.jsx("div",{className:"h-8/10 lg:w-3/5 mt-2 mx-auto shadow",children:t.jsx("div",{className:"w-[70%] mb-2 mx-auto w-80 max-w-screen-lg lg:w-1/2",children:t.jsxs("div",{children:[t.jsx("h2",{className:"bold text-xl",children:"LOGIN"}),t.jsxs(C,{initialValues:{email:"",password:""},validationSchema:g,onSubmit:u,login:!0,title:"Hi, welcome back to the best market place ",children:[t.jsx(k,{label:"Email",name:"email",type:"email"}),t.jsx(k,{label:"Password",name:"password",type:"password"})]})]})})})]})},D=v(P);function H(){return t.jsx("section",{children:t.jsx(D,{})})}export{H as SignIn,H as default};
